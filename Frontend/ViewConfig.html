<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View Logs - IoT Dashboard</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .logs-container {
            max-width: 1000px;
            margin: 2rem auto;
            padding: 2rem;
        }
        .logs-section {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .back-btn {
            background: linear-gradient(45deg, #FCB53B, #9b8662);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            margin-bottom: 2rem;
            text-decoration: none;
            display: inline-block;
        }
        .filter-section {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }
        .filter-input {
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 0.9rem;
        }
        .filter-input:focus {
            outline: none;
            border-color: #667eea;
        }
        .logs-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        .logs-table th,
        .logs-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        .logs-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
        }
        .logs-table tr:hover {
            background: #f8f9fa;
        }
        .status-online {
            color: #28a745;
            font-weight: 600;
        }
        .status-offline {
            color: #dc3545;
            font-weight: 600;
        }
        .pagination {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 2rem;
        }
        .page-btn {
            padding: 8px 12px;
            border: 1px solid #ddd;
            background: white;
            cursor: pointer;
            border-radius: 4px;
        }
        .page-btn:hover {
            background: #f8f9fa;
        }
        .page-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
    </style>
</head>
<body>
    <header class="nav-bar">
        <ul class="nav-list">
          <li style="font-size: xx-large;">Iot Website</li>
          <li><a href="index.html">Home</a></li>
          <li><a href="ViewConfig.html" class="active">View Config</a></li>
          <li><a href="TLF.html">Temperature Log Form</a></li>
          <li><a href="ViewLogs.html">View Logs</a></li>
        </ul>
      </header>
    <div class="shooting-star"></div>
    <div class="shooting-star"></div>
    <div class="shooting-star"></div>
    <div class="shooting-star"></div>
    <div class="shooting-star"></div>
    <div class="logs-container">
        <a href="index.html" class="back-btn font">â† Back to Dashboard</a>
        <h1 style="color: #ddd; font-size: 40px; font-weight: 900; font-family: 'Pacifico', cursive;;" class="text-center">à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ Drone</h1>
        
        <div class="logs-section">

            
            <table class="logs-table">
                <thead>
                    <tr>
                        <th>Drone_ID</th>
                        <th>Drone Name</th>
                        <th>Light Status</th>
                        <th>Country</th>
                    </tr>
                </thead>
                <tbody id="logsTableBody">
                </tbody>
            </table>

           
            <div style="margin-top:1rem;">
                <span id="message" style="margin-left:1rem;color:#c00;"></span>
            </div>
        </div>
    </div>

<script>
Â  Â  Â  
    // âŒ const API_BASE = 'http://localhost:3000' // ğŸ‘ˆ [à¹à¸à¹‰à¹„à¸‚] à¸¥à¸šà¸šà¸£à¸£à¸—à¸±à¸”à¸™à¸µà¹‰

Â  Â  Â  Â  function showMessage(text, isError = true) {
Â  Â  Â  Â  Â  Â  const el = document.getElementById('message')
Â  Â  Â  Â  Â  Â  el.style.color = isError ? '#c00' : '#080'
Â  Â  Â  Â  Â  Â  el.textContent = text
Â  Â  Â  Â  }

Â  Â  Â  Â  function clearTable() {
Â  Â  Â  Â  Â  Â  document.getElementById('logsTableBody').innerHTML = ''
Â  Â  Â  Â  }

Â  Â  Â  Â  function renderRow(item) {
Â  Â  Â  Â  Â  Â  const tbody = document.getElementById('logsTableBody')
Â  Â  Â  Â  Â  Â  const tr = document.createElement('tr')

Â  Â  Â  Â  Â  Â  const idTd = document.createElement('td')
Â  Â  Â  Â  Â  Â  idTd.textContent = item.drone_id ?? item.id ?? ''
Â  Â  Â  Â  Â  Â  tr.appendChild(idTd)

Â  Â  Â  Â  Â  Â  const nameTd = document.createElement('td')
Â  Â  Â  Â  Â  Â  nameTd.textContent = item.drone_name ?? item.droneName ?? item.name ?? ''
Â  Â  Â  Â  Â  Â  tr.appendChild(nameTd)

Â  Â  Â  Â  Â  Â  const lightTd = document.createElement('td')
Â  Â  Â  Â  Â  Â  lightTd.textContent = item.light ?? ''
Â  Â  Â  Â  Â  Â  tr.appendChild(lightTd)

Â  Â  Â  Â  Â  Â  const countryTd = document.createElement('td')
Â  Â  Â  Â  Â  Â  countryTd.textContent = item.country ?? ''
Â  Â  Â  Â  Â  Â  tr.appendChild(countryTd)

Â  Â  Â  Â  Â  Â  tbody.appendChild(tr)
Â  Â  Â  Â  }

Â  Â  Â  Â  async function fetchAndRender(droneId) {
Â  Â  Â  Â  Â  Â  if (!droneId) {
Â  Â  Â  Â  Â  Â  Â  Â  showMessage('à¸à¸£à¸¸à¸“à¸²à¸à¸£à¸­à¸ drone ID')
Â  Â  Â  Â  Â  Â  Â  Â  return
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  showMessage('à¸à¸³à¸¥à¸±à¸‡à¹‚à¸«à¸¥à¸”...', false) 
Â  Â  Â  Â  Â  Â  clearTable()
Â  Â  Â  Â  Â  Â  try {
                // â¬‡ï¸ [à¹à¸à¹‰à¹„à¸‚] â¬‡ï¸
Â  Â  Â  Â  Â  Â  Â  Â  const res = await fetch(`/configs/${encodeURIComponent(droneId)}`) // ğŸ‘ˆ à¸¥à¸š API_BASE
Â  Â  Â  Â  Â  Â  Â  Â  if (!res.ok) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const err = await res.json().catch(()=>({ error: res.statusText }))
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error(err.error || err.message || 'Request failed')
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  const data = await res.json()
Â  Â  Â  Â  Â  Â  Â  Â  renderRow(data)
Â  Â  Â  Â  Â  Â  Â  Â  showMessage('', false)
Â  Â  Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  Â  Â  showMessage(e.message || 'à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”')
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }


Â  Â  Â  Â  document.addEventListener('DOMContentLoaded', async () => {
Â  Â  Â  Â  Â  Â  let DRONE_ID_FROM_API; 
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  showMessage('Loading config...', false); 
Â  Â  Â  Â  Â  Â  Â  Â  
                // â¬‡ï¸ [à¹à¸à¹‰à¹„à¸‚] â¬‡ï¸
Â  Â  Â  Â  Â  Â  Â  Â  const configRes = await fetch('/api/config'); // ğŸ‘ˆ à¸¥à¸š API_BASE
Â  Â  Â  Â  Â  Â  Â  Â  if (!configRes.ok) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error('Failed to load app config from /api/config');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  const appConfig = await configRes.json();
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  DRONE_ID_FROM_API = appConfig.droneId; 

Â  Â  Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  Â  Â  showMessage(e.message); 
Â  Â  Â  Â  Â  Â  Â  Â  return; 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  fetchAndRender(DRONE_ID_FROM_API);
Â  Â  Â  Â  });
</script>
</body>
</html>
