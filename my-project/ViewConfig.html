<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View Logs - IoT Dashboard</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .logs-container {
            max-width: 1000px;
            margin: 2rem auto;
            padding: 2rem;
        }
        .logs-section {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .back-btn {
            background: linear-gradient(45deg, #FCB53B, #9b8662);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            margin-bottom: 2rem;
            text-decoration: none;
            display: inline-block;
        }
        .filter-section {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }
        .filter-input {
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 0.9rem;
        }
        .filter-input:focus {
            outline: none;
            border-color: #667eea;
        }
        .logs-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        .logs-table th,
        .logs-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        .logs-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
        }
        .logs-table tr:hover {
            background: #f8f9fa;
        }
        .status-online {
            color: #28a745;
            font-weight: 600;
        }
        .status-offline {
            color: #dc3545;
            font-weight: 600;
        }
        .pagination {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 2rem;
        }
        .page-btn {
            padding: 8px 12px;
            border: 1px solid #ddd;
            background: white;
            cursor: pointer;
            border-radius: 4px;
        }
        .page-btn:hover {
            background: #f8f9fa;
        }
        .page-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
    </style>
</head>
<body>
    <header class="nav-bar">
        <ul class="nav-list">
          <li style="font-size: xx-large;">Iot Website</li>
          <li><a href="index.html">Home</a></li>
          <li><a href="ViewConfig.html" class="active">View Config</a></li>
          <li><a href="TLF.html">Temperature Log Form</a></li>
          <li><a href="ViewLogs.html">View Logs</a></li>
        </ul>
      </header>
    <div class="shooting-star"></div>
    <div class="shooting-star"></div>
    <div class="shooting-star"></div>
    <div class="shooting-star"></div>
    <div class="shooting-star"></div>
    <div class="logs-container">
        <a href="index.html" class="back-btn font">← Back to Dashboard</a>
        <h1 style="color: #ddd; font-size: 40px; font-weight: 900; font-family: 'Pacifico', cursive;;" class="text-center">ข้อมูล Drone</h1>
        
        <div class="logs-section">

            
            <table class="logs-table">
                <thead>
                    <tr>
                        <th>Drone_ID</th>
                        <th>Drone Name</th>
                        <th>Light Status</th>
                        <th>Country</th>
                    </tr>
                </thead>
                <tbody id="logsTableBody">
                </tbody>
            </table>

           
            <div style="margin-top:1rem;">
                <span id="message" style="margin-left:1rem;color:#c00;"></span>
            </div>
        </div>
    </div>

<script>
      
        const API_BASE = 'http://localhost:3000'
        function showMessage(text, isError = true) {
            const el = document.getElementById('message')
            el.style.color = isError ? '#c00' : '#080'
            el.textContent = text
        }

        function clearTable() {
            document.getElementById('logsTableBody').innerHTML = ''
        }

        function renderRow(item) {
            const tbody = document.getElementById('logsTableBody')
            const tr = document.createElement('tr')

            const idTd = document.createElement('td')
            idTd.textContent = item.drone_id ?? item.id ?? ''
            tr.appendChild(idTd)

            const nameTd = document.createElement('td')
            nameTd.textContent = item.drone_name ?? item.droneName ?? item.name ?? ''
            tr.appendChild(nameTd)

            const lightTd = document.createElement('td')
            lightTd.textContent = item.light ?? ''
            tr.appendChild(lightTd)

            const countryTd = document.createElement('td')
            countryTd.textContent = item.country ?? ''
            tr.appendChild(countryTd)

            tbody.appendChild(tr)
        }

        async function fetchAndRender(droneId) {
            if (!droneId) {
                showMessage('กรุณากรอก drone ID')
                return
            }
            showMessage('กำลังโหลด...', false) 
            clearTable()
            try {
                const res = await fetch(`${API_BASE}/configs/${encodeURIComponent(droneId)}`)
                if (!res.ok) {
                    const err = await res.json().catch(()=>({ error: res.statusText }))
                    throw new Error(err.error || err.message || 'Request failed')
                }
                const data = await res.json()
                renderRow(data)
                showMessage('', false)
            } catch (e) {
                showMessage(e.message || 'เกิดข้อผิดพลาด')
            }
        }


        document.addEventListener('DOMContentLoaded', async () => {
            let DRONE_ID_FROM_API; 

            
            try {
              
                showMessage('Loading config...', false); 
                
                const configRes = await fetch(`${API_BASE}/api/config`);
                if (!configRes.ok) {
                    throw new Error('Failed to load app config from /api/config');
                }
                const appConfig = await configRes.json();
                
                DRONE_ID_FROM_API = appConfig.droneId; 

            } catch (e) {
                showMessage(e.message); 
                return; 
            }

            
            fetchAndRender(DRONE_ID_FROM_API);
        });
    </script>
</body>
</html>
